#!/bin/sh
PREREQ=""
prereqs()
{
        echo "$PREREQ"
}
case $1 in
prereqs)
        prereqs
        exit 0
        ;;
esac

PROFILE="profile init-systemd /lib/systemd/** flags=(complain) 
{
	/bin/*  rcx -> binprofile,
	
	/etc/init.d/* rcx -> binprofile,
	/etc/network/** rcx -> binprofile,
	/etc/console-setup/* rcx -> binprofile,
	/etc/ppp/** rcx -> binprofile,
	/lib/netplan/* rcx -> binprofile,
	/lib/udev/* rmcx -> binprofile,
	/lib/apparmor/* rcx -> binprofile,
	/sbin/apparmor_parser rux,
	/sbin/* rcx ->  sbinprofile,	

	/usr/bin/* rcx -> usrbinprofile,
	

	/usr/lib/** rcx -> usrlibprofile,
	
	/usr/libexec/** rcx -> usrlibprofile,
	/usr/sbin/update-initramfs rux,

	/usr/sbin/* rcx -> usrsbinprofile,
	/usr/share/** rcx -> usrsbinprofile,
	/opt/** rcx -> usrsbinprofile,
	

    capability,	

    /dev/** rwk,
    /etc/** r,

    /lib/console-setup/*    rmix,
    /lib/ufw/* rmix,   
    
    /lib/systemd/** rix,
    /lib/** rm,
    mount, 
   
    /proc/** rw,
    ptrace, 
  
    /run/** rwkcx -> run_default,
    signal, 
    /sys/** rwcx -> sys_default,
    /snap/** r,
    umount,
    /usr/ r,
    /usr/lib/x86_64-linux-gnu/**    rm,
    /usr/** rw,
    /var/** rwk,
    /tmp/** rw,
    / r,
    profile run_default flags=(complain){
  
    }
  
    profile sys_default flags=(complain){
   
    }
       
    profile default_profile flags=(complain){

	}

	

	
	profile sbinprofile {
		capability,
		ptrace,
		mount,
		signal,
		
		/bin/* rpix,		
		capability,
		/dev/ r,
		/dev/null rw,
		/dev/** rwk,
		/etc/** rwpix,
		/home/abhishek/ r,
		/home/abhishek/.*/** rwk,
		/home/abhishek/** rwkpix,
		/lib/** rmpix,
		/opt/** rmpix,
		/proc/ r,
		/proc/[0-9]*/** rw,
		/proc/sys/** rw,
		/proc/* r,
	    	/sys/kernel/security/apparmor/.replace w,
		/sbin/* rpix,
		/snap/** rmpix,
		/sys/kernel/security/apparmor/** rw,	
		/sys/bus/** rw,	
		/sys/** r,
		/swapfile r,
		/swapfile wr,
		/run/** rwkpix,
		/usr/** rmpix,
		/var/** rwk,
		/tmp/** rwpix,	
		
	}



	profile systemd_journal flags=(complain){
		ptrace,
		signal,
		capability,
	}



	profile binprofile flags=(complain){
		capability,
		ptrace,
		mount,
		signal,
		/ r,
		/bin/** rix,
		/boot/ r,
		/boot/** rwix,
		/dev/ r,
		/dev/null rw,
		/dev/** rwk,
		/etc/** rwkix,
		/home/ r,
		/home/abhishek/ r,
		/home/abhishek/.*/** rwk,
		/home/abhishek/** rwk,
		/lib/** rmix,
		/opt/** rmix,
		/proc/ r,
		/proc/[0-9]*/** rw,
		/proc/sys/** rw,
		/proc/* r,
		/sbin/* rix,	
		/snap/** rmix,
		/srv/ r,
		/sys/bus/** rw,
		/sys/module/** rw,	
		/sys/** rw,
		/run/** rwkix,
		/usr/** rmix,
		/var/ r,
		/var/** rwkix,
		/tmp/ r,
		/tmp/** rwix,	
			
	}
	
	profile usrbinprofile {
		capability,
		ptrace,
		mount,
		signal,
		
		/bin/* rpix,
		/boot/grub/* rwpix,		
		/dev/ r,		
		/dev/null rw,
		/dev/** rwk,

		/etc/** rwpix,
		/home/abhishek/ r,
		/home/abhishek/.*/** rwk,
		/home/abhishek/** rwkpix,
	
		/lib/** rmpix,
		/opt/** rmpix,
		/proc/ r,
		/proc/[0-9]*/oom_score_adj w,
		/proc/[0-9]*/** rw,
		/proc/sys/** rw,
		/proc/mtrr w,
		/proc/* r,
		/run/** rwkpix,
		

		/sbin/* rpix,
		/snap/** rmpix,
		/sys/bus/** rw,
		/sys/** r,
		/usr/** rmpix,
		/var/** rwlkpix,
		/tmp/ r,
		/tmp/** rwpix,	
		
	}
	
	profile usrsbinprofile flags=(complain){
		capability,
		ptrace,
		mount,
		signal,
		/ r,
		/bin/* rix,
		/dev/ r,		
		/dev/null rw,
		/dev/** rwk,		
		/etc/** rwkix,
		/home/abhishek/ r,
		/home/abhishek/.*/** rwlk,
		/home/abhishek/** rwmlk,
		/lib/** rmix,
		/opt/** rmix,
		/proc/ r,
		/proc/[0-9]*/** rw,
		/proc/* r,
		/proc/sys/** rw,

		/run/** rwkix,
		/sbin/* rix,
		/snap/** rmix,
		/sys/bus/** rw,
		/sys/** r,
		/usr/** rmix,
		/var/** rwlkix,
		/tmp/ r,
		/tmp/** rwix,	
		
	}
	
	profile usrlibprofile {
		capability,
		ptrace,
		mount,
		umount,
		signal,
		/bin/ r,
		/bin/* rpix,
		/dev/ r,		
		/dev/bus/usb/ r,
		/dev/null wr,
		/dev/** rwk,
		
		/etc/** rwpix,
		/home/abhishek/ r,
		/home/abhishek/.*/** rwk,		
		/home/abhishek/** rwkpix,
		
		/lib/** rmpix,
		/opt/** rmpix,
		/proc/ r,
		/proc/[0-9]*/** rw,
		/proc/* r,
		/proc/sys/** rw,
				
		/run/** rwkpix,
		/sbin/ r,
		/sbin/* rpix,
		/snap/** rmpix,
		/sys/bus/** rw,
		/sys/** r,
		/usr/** rmpix,
		/var/** rwkpix,
		/tmp/ r,		
		/tmp/** rwpix,		
		
	}



}"

mount -t securityfs none /sys/kernel/security
#echo "profile init-systemd /lib/systemd/** flags=(complain) {/lib/systemd/* ix, /{,usr/}{,s}bin/* pix, /opt/** Px,}" | /sbin/apparmor_parser -a
#echo "profile init-upstart /sbin/upstart flags=(complain) {}" | /sbin/apparmor_parser -a

echo "$PROFILE" | /sbin/apparmor_parser -a
#echo "profile init-upstart /sbin/upstart flags=(complain) {}" | /sbin/apparmor_parser -a

read -p "Enter a name: " name
echo "Hi, $name"
