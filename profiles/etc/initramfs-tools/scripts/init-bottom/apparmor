#!/bin/sh
PREREQ=""
prereqs()
{
        echo "$PREREQ"
}
case $1 in
prereqs)
        prereqs
        exit 0
        ;;
esac

PROFILE="profile init-systemd /lib/systemd/** flags=(complain)
{
	/bin/mount rux,
	/sbin/apparmor_parser rux,

	/etc/init.d/kdump-tools rcx -> bootprocesses ,
	/lib/apparmor/apparmor.systemd rcx -> bootprocesses ,
	/lib/netplan/generate   rcx -> bootprocesses ,

	/lib/systemd/systemd rcx -> bootprocesses ,
	/lib/systemd/systemd-udevd   rcx -> bootprocesses ,
	/opt/VBoxGuestAdditions-5.2.16/init/vboxadd rcx -> bootprocesses ,
	/sbin/ifup rcx -> bootprocesses ,
	/sbin/plymouthd   rcx -> bootprocesses ,
	
	/usr/bin/dbus-daemon   rcx -> bootprocesses ,
	/usr/bin/networkd-dispatcher   rcx -> bootprocesses ,
	/usr/bin/snap   rcx -> bootprocesses ,
	/usr/lib/colord/colord   rcx -> bootprocesses ,
	/usr/lib/packagekit/packagekitd rcx -> bootprocesses ,
	/usr/lib/snapd/snapd rcx -> bootprocesses ,
	/usr/lib/NetworkManager/nm-dispatcher   rcx -> bootprocesses ,
	/usr/lib/accountsservice/accounts-daemon   rcx -> bootprocesses ,
	/usr/lib/policykit-1/polkitd   rcx -> bootprocesses ,
	/usr/lib/systemd/system-environment-generators/snapd-env-generator   rcx -> bootprocesses ,
	/usr/lib/udisks2/udisksd   rcx -> bootprocesses ,

	/usr/sbin/NetworkManager   rcx -> bootprocesses ,
	/usr/sbin/cupsd   rcx -> bootprocesses ,
	/usr/sbin/gdm3 rcx -> bootprocesses ,
	/usr/sbin/rsyslogd   rcx -> bootprocesses ,
	/usr/share/unattended-upgrades/unattended-upgrade-shutdown   rcx -> bootprocesses ,
	
	capability,	
	/lib/console-setup/*    rmix,
	/lib/ufw/* rmix,   
	/lib/systemd/** rix,
	
	mount, 
	ptrace, 
	signal, 
	umount,
	/ r,
	/** rwmk,
	
	profile bootprocesses flags=(complain){
		capability,
		ptrace,
		mount,
		signal,
		/bin/cp   rix ,
		/bin/dash rix ,
		/bin/grep   rix ,
		/bin/sed   rix ,
		/bin/run-parts rix ,
		/etc/gdm3/Xsession rix ,
		/etc/network/if-pre-up.d/wireless-tools   rix ,
		/etc/NetworkManager/dispatcher.d/01-ifupdown   rix ,		
		/opt/VBoxGuestAdditions-5.2.16/src/vboxguest-5.2.16/build_in_tmp   rix ,
		/sbin/iwconfig   rix ,
		/snap/core/7713/usr/lib/snapd/snapd   rix ,
		/usr/bin/Xorg rix ,
		/usr/bin/dpkg   rix ,
		/usr/bin/env rix ,
		/usr/bin/find   rix ,
		/usr/bin/gnome-session rix ,
		/usr/bin/gnome-shell   rix ,
		/usr/bin/gnome-software   rix ,
		/usr/bin/im-launch rix ,
		/usr/bin/ionice rix ,
		/usr/bin/make rix ,
		/usr/bin/nice rix ,
		/usr/bin/ssh-agent rix ,
		/usr/bin/update-notifier   rix ,
		/usr/bin/update-notifier rix ,
		/usr/bin/x86_64-linux-gnu-gcc-8   rix ,
		/usr/bin/x86_64-linux-gnu-gcc-8 rix ,
		/usr/bin/x86_64-linux-gnu-ld.bfd   rix ,
		/usr/lib/cnf-update-db   rix ,
		/usr/lib/gcc/x86_64-linux-gnu/8/collect2   rix ,
		/usr/lib/gcc/x86_64-linux-gnu/8/collect2 rix ,
		/usr/lib/gdm3/gdm-session-worker   rix ,
		/usr/lib/gdm3/gdm-session-worker rix ,
		/usr/lib/gdm3/gdm-wayland-session rix ,
		/usr/lib/gdm3/gdm-x-session rix ,
		/usr/lib/gnome-session/gnome-session-binary   rix ,
		/usr/lib/gnome-session/gnome-session-binary rix ,
		/usr/lib/gvfs/gvfsd   rix ,
		/usr/lib/tracker/tracker-miner-apps   rix ,
		/usr/lib/tracker/tracker-store   rix ,
		/usr/lib/update-notifier/apt_check.py   rix ,
		/usr/lib/x86_64-linux-gnu/glib-2.0/gio-launch-desktop rix ,
		/usr/lib/xorg/Xorg   rix ,
		/usr/lib/xorg/Xorg.wrap rix ,
		/usr/sbin/kdump-config rix ,
		
		/usr/share/apport/apport-checkreports   rix ,
		
		/** rwmkl,
		
	}

	
}"

mount -t securityfs none /sys/kernel/security
#echo "profile init-systemd /lib/systemd/** flags=(complain) {/lib/systemd/* ix, /{,usr/}{,s}bin/* pix, /opt/** Px,}" | /sbin/apparmor_parser -a
#echo "profile init-upstart /sbin/upstart flags=(complain) {}" | /sbin/apparmor_parser -a

echo "$PROFILE" | /sbin/apparmor_parser -a
#echo "profile init-upstart /sbin/upstart flags=(complain) {}" | /sbin/apparmor_parser -a

read -p "Enter a name: " name
echo "Hi, $name"
